<!DOCTYPE html>
<!-- 
    üêç HOLA, SR. EME. SOY TU ARQUITECTA WEB SUPREMA G.
    
    Bienvenido al c√≥digo fuente de tu Plantilla Maestra.
    He dise√±ado este archivo para que sea una aventura did√°ctica.
    
    Busca las etiquetas que dicen [EDITABLE] para saber qu√© cambiar.
    Todo el CSS (estilos), HTML (estructura) y JS (magia) est√° aqu√≠, en un solo archivo.
-->
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- [EDITABLE] T√≠tulo que aparece en la pesta√±a del navegador -->
    <title>1337 Tech Solutions ‚Äî Metamapa</title>
    
    <!-- Metaetiqueta para que se vea bien en m√≥viles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fuentes de Google (Inter y JetBrains Mono para ese toque Hacker) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* üé® ZONA DE ESTILOS (CSS) 
           Aqu√≠ definimos la "piel" de tu sitio web.
        */

        :root {
            /* Variables por defecto (Base) */
            --bg: #0a0a15;
            --fg: #e6eef6;
            --muted: #9aa7b8;
            --accent: #00ccff; /* Azul el√©ctrico */
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --node-size: 140px;
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* [TEMA] Angel - Luz y suavidad */
        body.theme-angel {
            --bg: #fdfbf7;
            --fg: #2d3436;
            --muted: #636e72;
            --accent: #fd79a8; /* Rosa suave */
            --glass: rgba(0, 0, 0, 0.03);
            --border: rgba(0, 0, 0, 0.08);
        }

        /* [TEMA] Dark - Profundidad y elegancia (Tu favorito base) */
        body.theme-dark {
            --bg: #0b0c10;
            --fg: #c5c6c7;
            --muted: #848991;
            --accent: #66fcf1; /* Cian ne√≥n */
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
        }

        /* [TEMA] Hacker - Matrix / Cyberpunk (Inspirado en tus im√°genes) */
        body.theme-hacker {
            --bg: #000000;
            --fg: #00ff41; /* Verde terminal cl√°sico */
            --muted: #008f11;
            --accent: #ffee00; /* Amarillo peligro/biohazard */
            --glass: rgba(0, 255, 65, 0.05);
            --border: rgba(0, 255, 65, 0.3);
            --font-main: 'JetBrains Mono', monospace; /* Todo monoespaciado */
        }

        /* Reset b√°sico */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background: var(--bg);
            color: var(--fg);
            height: 100vh;
            overflow: hidden; /* Evitamos scroll doble, gestionamos scroll interno */
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* üñåÔ∏è PERSONALIZACI√ìN DE SCROLLBARS 
           Aqu√≠ hacemos que las barras sean del color del tema.
        */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--fg);
        }

        /* Estructura Principal */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            z-index: 20;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            height: 70px; /* Altura base */
        }

        /* Efecto de encoger Header al bajar */
        header.shrink {
            padding: 5px 30px;
            height: 50px;
            opacity: 0.9;
        }
        header.shrink h1 { font-size: 1.2rem; }

        header h1 {
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        /* Controles de tema en el Header */
        .theme-controls {
            display: flex;
            gap: 10px;
        }
        .theme-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }
        .theme-btn:hover { transform: scale(1.2); border-color: var(--fg); }
        /* Colores de los botones */
        .t-angel { background: #fdfbf7; }
        .t-dark { background: #0b0c10; }
        .t-hacker { background: #000; border-color: #00ff41; }

        /* --- MAIN LAYOUT --- */
        main {
            flex: 1;
            display: flex;
            overflow: hidden; /* El contenido hace scroll dentro */
            position: relative;
        }

        /* √Årea del Mapa (Canvas) */
        .canvas-area {
            flex: 1;
            position: relative;
            overflow: auto; /* Permite mover el mapa */
            background-image: 
                radial-gradient(var(--border) 1px, transparent 1px);
            background-size: 40px 40px; /* Rejilla de fondo */
        }

        /* Contenedor interno del mapa (donde viven los nodos) */
        .map-surface {
            width: 1600px; /* [EDITABLE] Ancho del lienzo virtual */
            height: 1000px; /* [EDITABLE] Alto del lienzo virtual */
            position: relative;
        }

        /* --- NODOS (Las burbujas) --- */
        .node {
            position: absolute;
            width: var(--node-size);
            height: var(--node-size);
            border-radius: 50%; /* C√≠rculo perfecto */
            background: var(--glass);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            transition: box-shadow 0.3s, border-color 0.3s;
            z-index: 2;
            
            /* Animaci√≥n de flotaci√≥n (Fluido) */
            animation: float 6s ease-in-out infinite;
        }

        /* Animaci√≥n Keyframes para el efecto fluido */
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        /* Efectos Hover Nodos */
        .node:hover {
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent);
            z-index: 10;
        }
        
        /* Tema Hacker espec√≠fico para nodos */
        body.theme-hacker .node {
            border: 1px solid var(--accent);
            box-shadow: 0 0 5px var(--accent);
        }
        body.theme-hacker .node:hover {
            background: var(--accent);
            color: #000;
            box-shadow: 0 0 50px var(--accent);
        }

        .node h3 {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 700;
            pointer-events: none; /* Click atraviesa el texto */
        }
        .node p {
            font-size: 0.7rem;
            opacity: 0.8;
            pointer-events: none;
        }

        /* --- CONECTORES (SVG) --- */
        svg.connections {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        path.connection-line {
            fill: none;
            stroke: var(--border);
            stroke-width: 2;
        }
        
        /* Efecto "Cometa" o Red Neuronal */
        path.connection-active {
            fill: none;
            stroke: var(--accent);
            stroke-width: 2;
            stroke-dasharray: 10, 20; /* Rayitas */
            animation: dash 30s linear infinite; /* Movimiento */
            opacity: 0.6;
        }

        @keyframes dash {
            to { stroke-dashoffset: -1000; }
        }

        /* --- SIDEBAR (Barra lateral derecha) --- */
        aside {
            width: 350px;
            background: var(--glass);
            border-left: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 5;
            backdrop-filter: blur(15px);
            overflow-y: auto;
        }

        .sidebar-section h4 {
            color: var(--accent);
            text-transform: uppercase;
            font-size: 0.8rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        .sidebar-text {
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--muted);
        }

        /* Lista de Botones de Nodos en Sidebar */
        .node-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .node-link-btn {
            background: transparent;
            border: 1px solid transparent;
            color: var(--fg);
            text-align: left;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            font-family: var(--font-mono);
            font-size: 0.8rem;
        }
        .node-link-btn:hover {
            background: var(--glass);
            border-color: var(--accent);
            color: var(--accent);
            padding-left: 15px; /* Efecto deslizamiento */
        }
        .node-link-btn::before { content: '> '; opacity: 0.5; }

        /* Botones de Operaciones */
        .op-btn {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--accent);
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .op-btn:hover { background: var(--accent); color: var(--bg); }

        /* --- FOOTER --- */
        footer {
            border-top: 1px solid var(--border);
            padding: 15px 30px;
            background: var(--bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--muted);
            transition: all 0.4s ease;
            height: 50px; /* Altura base */
        }

        /* Efecto de crecer Footer al bajar */
        footer.expand {
            height: 80px;
            background: var(--glass);
        }
        footer.expand .footer-logo { font-size: 1.2rem; color: var(--accent); }

        .footer-logo { font-weight: bold; transition: 0.3s; }
        .footer-links a {
            color: var(--fg);
            text-decoration: none;
            margin-left: 20px;
            position: relative;
        }
        .footer-links a:hover { color: var(--accent); }

        /* --- MODAL (Ventana Emergente) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none; /* No clickeable cuando est√° invisible */
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--bg);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .btn-close-x {
            position: absolute;
            top: 10px; right: 15px;
            background: none;
            border: none;
            color: var(--muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .btn-close-x:hover { color: var(--accent); }

        .modal-actions {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            border: none;
        }
        .btn-primary { background: var(--accent); color: var(--bg); }
        .btn-secondary { background: transparent; border: 1px solid var(--muted); color: var(--fg); }
        .btn-secondary:hover { border-color: var(--fg); }

        /* --- RESPONSIVE M√ìVIL (Reglas especiales) --- */
        @media (max-width: 768px) {
            .app-container { height: auto; min-height: 100vh; }
            
            main { flex-direction: column; height: auto; overflow: visible; }
            
            /* En m√≥vil, el mapa no es draggable, es una lista grid */
            .canvas-area {
                height: auto;
                padding: 20px;
                overflow: visible;
            }
            .map-surface {
                width: 100%;
                height: auto;
                display: grid;
                grid-template-columns: 1fr 1fr; /* [L√ìGICA] De dos en dos */
                gap: 20px;
                position: relative; /* Reset position */
            }

            /* Los conectores SVG se ocultan en m√≥vil porque la grid rompe la posici√≥n absoluta */
            svg.connections { display: none; }

            .node {
                position: relative; /* Ya no es absolute */
                left: auto !important;
                top: auto !important;
                width: 100%;
                margin: 0 auto;
            }

            aside {
                width: 100%;
                border-left: none;
                border-top: 1px solid var(--border);
                max-height: none;
            }

            footer { flex-direction: column; gap: 10px; text-align: center; }
            .footer-links a { margin: 5px; display: inline-block; }
        }

    </style>
</head>
<body class="theme-dark"> <!-- [EDITABLE] Cambia 'theme-dark' por 'theme-angel' o 'theme-hacker' para ver el defecto -->

    <div class="app-container">
        
        <!-- HEADER -->
        <header id="mainHeader">
            <!-- [EDITABLE] T√≠tulo principal -->
            <h1>Metamapa <span style="font-size:0.5em; opacity:0.5; vertical-align: middle;">// MalizIA</span></h1>
            
            <!-- Selector de Temas (Arriba, como pediste) -->
            <div class="theme-controls">
                <button class="theme-btn t-angel" onclick="setTheme('theme-angel')" title="Modo Angel"></button>
                <button class="theme-btn t-dark" onclick="setTheme('theme-dark')" title="Modo Oscuro"></button>
                <button class="theme-btn t-hacker" onclick="setTheme('theme-hacker')" title="Modo Hacker (1337)"></button>
            </div>
        </header>

        <main>
            <!-- √ÅREA VISUAL (Nodos) -->
            <section class="canvas-area">
                <div class="map-surface" id="nodeMap">
                    <!-- SVG para las l√≠neas -->
                    <svg class="connections" id="svgLayer"></svg>
                    
                    <!-- 
                        [DIN√ÅMICO] Los nodos se generan aqu√≠ con JavaScript.
                        No necesitas escribir HTML aqu√≠, edita la variable 'manifest' abajo.
                    -->
                </div>
            </section>

            <!-- BARRA LATERAL (Sidebar) -->
            <aside>
                <!-- Secci√≥n 1: Descripci√≥n -->
                <div class="sidebar-section">
                    <h4>Descripci√≥n</h4> <!-- [EDITABLE] T√≠tulo de la secci√≥n -->
                    <!-- [EDITABLE] Texto de misi√≥n -->
                    <p class="sidebar-text">
                        Bienvenido al n√∫cleo de operaciones de 1337 Tech Solutions. 
                        Este metamapa interactivo visualiza nuestra infraestructura descentralizada. 
                        Explora los nodos para entender nuestra soberan√≠a de datos.
                    </p>
                </div>

                <!-- Secci√≥n 2: Nodos (Lista de accesos directos) -->
                <div class="sidebar-section">
                    <h4>Nodos Activos</h4>
                    <div class="node-list" id="sidebarNodeList">
                        <!-- Se llena autom√°ticamente con JS -->
                    </div>
                </div>

                <!-- Secci√≥n 3: Operaciones (Importar/Exportar) -->
                <div class="sidebar-section">
                    <h4>Operaciones</h4>
                    <button class="op-btn" onclick="exportManifest()">üíæ Exportar Manifiesto (JSON)</button>
                    <button class="op-btn" onclick="triggerImport()">üìÇ Importar Manifiesto</button>
                    <input type="file" id="fileInput" style="display: none;" accept=".json" onchange="importManifest(this)">
                    <p class="sidebar-text" style="font-size: 0.7rem; margin-top: 10px; opacity: 0.7;">
                        *Backup local autom√°tico activado.
                    </p>
                </div>
            </aside>
        </main>

        <!-- FOOTER -->
        <footer id="mainFooter">
            <div class="footer-logo">1337-TECH-SOLUTIONS</div>
            <div class="footer-links">
                <!-- [EDITABLE] Enlaces del pie de p√°gina -->
                <a href="#">Contacto</a>
                <a href="#">Manifiesto</a>
            </div>
        </footer>

    </div>

    <!-- MODAL (Oculto por defecto) -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="btn-close-x" onclick="closeModal()">√ó</button>
            <h2 id="modalTitle" style="color: var(--accent); margin-bottom: 15px;">T√≠tulo del Nodo</h2>
            <p id="modalBody" style="line-height: 1.6; color: var(--fg);">Texto descriptivo del nodo...</p>
            
            <div class="modal-actions">
                <button class="action-btn btn-secondary" onclick="closeModal()">Cerrar</button>
                <button class="action-btn btn-primary" id="modalLinkBtn">Saber m√°s</button>
            </div>
        </div>
    </div>

    <!-- 
       üß† ZONA DE CEREBRO (JAVASCRIPT) 
       Aqu√≠ ocurre la magia de la interactividad.
    -->
    <script>
        /* [EDITABLE] CONFIGURACI√ìN DE DATOS (MANIFIESTO)
           Aqu√≠ defines tus 12 nodos.
           - id: identificador √∫nico.
           - title: T√≠tulo corto.
           - desc: Texto gen√©rico (como pediste).
           - x, y: Posici√≥n en el mapa (en p√≠xeles).
           - link: A d√≥nde lleva el bot√≥n "Saber m√°s".
        */
        const defaultManifest = [
            { id: "n1", title: "NODO 01", desc: "TEXTO", x: 150, y: 100, link: "#page1" },
            { id: "n2", title: "NODO 02", desc: "TEXTO", x: 400, y: 150, link: "#page2" },
            { id: "n3", title: "NODO 03", desc: "TEXTO", x: 650, y: 100, link: "#page3" },
            { id: "n4", title: "NODO 04", desc: "TEXTO", x: 900, y: 150, link: "#page4" },
            { id: "n5", title: "NODO 05", desc: "TEXTO", x: 200, y: 350, link: "#page5" },
            { id: "n6", title: "NODO 06", desc: "TEXTO", x: 500, y: 300, link: "#page6" },
            { id: "n7", title: "NODO 07", desc: "TEXTO", x: 800, y: 350, link: "#page7" },
            { id: "n8", title: "NODO 08", desc: "TEXTO", x: 150, y: 600, link: "#page8" },
            { id: "n9", title: "NODO 09", desc: "TEXTO", x: 400, y: 550, link: "#page9" },
            { id: "n10", title: "NODO 10", desc: "TEXTO", x: 650, y: 600, link: "#page10" },
            { id: "n11", title: "NODO 11", desc: "TEXTO", x: 900, y: 550, link: "#page11" },
            { id: "n12", title: "NODO 12", desc: "TEXTO", x: 525, y: 800, link: "#page12" }
        ];

        // Estado global
        let nodesData = [];

        // --- INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            loadManifest();
            renderMap();
            setupScrollEffects();
            setupDoubleClickListener();
        });

        // Cargar datos (Local Storage o Default)
        function loadManifest() {
            const stored = localStorage.getItem('metamapa_manifest_v1');
            if (stored) {
                try {
                    nodesData = JSON.parse(stored);
                    console.log("Datos cargados de backup local.");
                } catch (e) {
                    console.error("Error leyendo backup, usando default.");
                    nodesData = defaultManifest;
                }
            } else {
                nodesData = defaultManifest;
            }
        }

        // Renderizar el mapa (Nodos y L√≠neas)
        function renderMap() {
            const container = document.getElementById('nodeMap');
            const sidebarList = document.getElementById('sidebarNodeList');
            const svg = document.getElementById('svgLayer');
            
            // Limpiar (menos el SVG que regeneramos)
            const existingNodes = document.querySelectorAll('.node');
            existingNodes.forEach(n => n.remove());
            sidebarList.innerHTML = '';
            svg.innerHTML = ''; // Limpiar l√≠neas

            // Generar contenido
            nodesData.forEach((node, index) => {
                // 1. Crear Nodo Visual (Burbuja)
                const el = document.createElement('div');
                el.className = 'node';
                // Delay aleatorio para la animaci√≥n de flotar (para que no se muevan todos igual)
                el.style.animationDelay = `${Math.random() * 5}s`;
                el.style.left = `${node.x}px`;
                el.style.top = `${node.y}px`;
                el.onclick = () => openModal(node);
                el.innerHTML = `
                    <h3>${node.title}</h3>
                    <p>${node.desc}</p>
                `;
                container.appendChild(el);

                // 2. Crear Elemento en la Lista Lateral
                const li = document.createElement('button');
                li.className = 'node-link-btn';
                li.innerText = node.title;
                li.onclick = () => openModal(node);
                sidebarList.appendChild(li);

                // 3. Conectar nodos (Dibujar l√≠neas al siguiente)
                // L√≥gica simple: conecta nodo 1 con 2, 2 con 3... y cierra el √∫ltimo con el primero o aleatorio
                if (index < nodesData.length - 1) {
                    drawLine(node, nodesData[index+1], svg);
                }
                // Conexiones extra para red (ejemplo: pares e impares)
                if (index % 2 === 0 && index + 2 < nodesData.length) {
                    drawLine(node, nodesData[index+2], svg, true); // true = l√≠nea punteada animada
                }
            });
        }

        // Funci√≥n auxiliar para dibujar l√≠neas SVG
        function drawLine(n1, n2, svgContainer, dashed = false) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            
            // Calculamos centro de los nodos (asumiendo 140px tama√±o)
            // Offset es mitad del tama√±o del nodo
            const offset = 70; 
            const x1 = n1.x + offset;
            const y1 = n1.y + offset;
            const x2 = n2.x + offset;
            const y2 = n2.y + offset;

            // Curva Bezier simple
            const d = `M ${x1} ${y1} Q ${(x1+x2)/2} ${(y1+y2)/2 + 50} ${x2} ${y2}`;
            
            line.setAttribute('d', d);
            line.setAttribute('class', dashed ? 'connection-active' : 'connection-line');
            svgContainer.appendChild(line);
        }

        // --- SISTEMA DE MODALES ---
        const modal = document.getElementById('modalOverlay');
        const mTitle = document.getElementById('modalTitle');
        const mBody = document.getElementById('modalBody');
        const mLink = document.getElementById('modalLinkBtn');

        function openModal(node) {
            mTitle.innerText = node.title;
            mBody.innerText = node.desc + " - Aqu√≠ puedes extender la informaci√≥n en el futuro.";
            mLink.onclick = () => window.open(node.link, '_blank'); // Abrir p√°gina externa
            
            modal.classList.add('active'); // Usamos clase CSS para visibilidad (funciona en Firefox)
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        // Cerrar con doble clic en cualquier parte del documento (si el modal est√° abierto)
        function setupDoubleClickListener() {
            document.addEventListener('dblclick', (e) => {
                if (modal.classList.contains('active')) {
                    closeModal();
                }
            });
            // Tambi√©n cerrar si se hace clic fuera del contenido (en el fondo oscuro)
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
        }

        // --- GESTI√ìN DE TEMAS ---
        function setTheme(themeName) {
            document.body.className = themeName;
            // Guardar preferencia si quisieras
        }

        // --- EFECTOS DE SCROLL (Header/Footer Din√°mico) ---
        function setupScrollEffects() {
            let lastScrollY = window.scrollY;
            const header = document.getElementById('mainHeader');
            const footer = document.getElementById('mainFooter');

            window.addEventListener('scroll', () => {
                const currentScrollY = window.scrollY;

                if (currentScrollY > lastScrollY) {
                    // Bajando: Header peque√±o, Footer grande
                    header.classList.add('shrink');
                    footer.classList.add('expand');
                } else {
                    // Subiendo: Header normal, Footer normal
                    header.classList.remove('shrink');
                    footer.classList.remove('expand');
                }
                lastScrollY = currentScrollY;
            });
        }

        // --- IMPORTAR / EXPORTAR ---
        
        function exportManifest() {
            const dataStr = JSON.stringify(nodesData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = "manifiesto_1337.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function triggerImport() {
            document.getElementById('fileInput').click();
        }

        function importManifest(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    // Validaci√≥n b√°sica
                    if (Array.isArray(json)) {
                        nodesData = json;
                        // Guardar backup local
                        localStorage.setItem('metamapa_manifest_v1', JSON.stringify(nodesData));
                        renderMap(); // Redibujar
                        alert("Manifiesto importado y guardado correctamente.");
                    } else {
                        alert("El archivo JSON no tiene el formato correcto (debe ser un Array).");
                    }
                } catch (err) {
                    alert("Error al leer el archivo JSON.");
                }
            };
            reader.readAsText(file);
        }

    </script>
</body>
</html>
